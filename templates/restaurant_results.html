{% extends 'base.html' %}

{% block content %}
	<h2>Restaurant search results: </h2>
	<div class = "bookmark-message"></div>
	<table class="table table-striped table-hover">
	    <thead>
	        <th>Restaurant</th>
	        <th>Address</th>
	        <th>City </th>
	        <th>State</th>
	    </thead>
	    <tbody>
		    {% for item in fsq_venues %}
		    	{% if item.location.address is defined %}
				    <tr class='clickable-row' data-id= "{{item.id}}" data-name="{{item.name}}" data-lat="{{item.location.lat}}" data-lng="{{item.location.lng}}" data-cuisine="{{item.categories.0.shortName}}">
				        <td>{{ item['name'] }} </td>
				        <td>{{ item['location']['address'] }}</td>
				        <td>{{ item['location']['city'] }}</td>
				        <td>{{ item['location']['state'] }}</td>
				 	</tr>
				{% endif %}
			{% endfor %}
		</tbody>
    </table>

{% endblock %}

{% block js_code %}
	<script>
	$('.clickable-row').click(function(e){
		var fsqId = $(this).data('id')
		var name = $(this).data('name')
		var lat = $(this).data('lat')
		var lng = $(this).data('lng')
		var cuisine = $(this).data('cuisine')
		
		var fsqData = {
			"name": name, 
			"fsqId":fsqId, 
			"lat": lat, 
			"lng": lng, 
			"cuisine": cuisine
		}

		//show a message telling user they have bookmarked the restaurant - callback function for get request
		function showMessage(response) {
			console.log(response);
			$(".bookmark-message").append(response.message);
		}

		$.get("/save-db", fsqData, showMessage);

	}); 
	</script>
{% endblock %}