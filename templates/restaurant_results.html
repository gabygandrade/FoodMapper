{% extends 'base.html' %}

{% block content %}
	<h2>Restaurant search results: </h2>
	<div class="flash-notice"></div>
	<table class="table table-striped table-hover">
	    <thead>
	        <th>Restaurant</th>
	        <th>Address</th>
	        <th>City </th>
	        <th>State</th>
	        <th>Add to my Bookmarks</th>
	        <th>Recommend To a Friend</th>
	    </thead>
	    <tbody>
		    {% for item in fsq_venues %}
		    	{% if item.location.address is defined %}
		    		{% if item.url is defined %}
					    <tr class='selected-row' data-id= "{{item.id}}" data-name="{{item.name}}" data-lat="{{item.location.lat}}" data-lng="{{item.location.lng}}" data-cuisine="{{item.categories.0.shortName}}" data-address="{{item.location.address}}" data-city="{{item.location.city}}" data-state ="{{item.location.state}}" data-phone="{{item.contact.phone}}" data-url ="{{item.url}}">
					{% else %}
						 <tr class='selected-row' data-id= "{{item.id}}" data-name="{{item.name}}" data-lat="{{item.location.lat}}" data-lng="{{item.location.lng}}" data-cuisine="{{item.categories.0.shortName}}" data-address="{{item.location.address}}" data-city="{{item.location.city}}" data-state ="{{item.location.state}}" data-phone="{{item.contact.phone}}" data-url ="unavailable">
					{% endif %}
					        <td>{{ item['name'] }}</td>
					        <td>{{ item['location']['address'] }}</td>
					        <td>{{ item['location']['city'] }}</td>
					        <td>{{ item['location']['state'] }}</td>
					        <td><button class="add-bookmark">Bookmark</button></td>
					        <td><button class="recommend">Recommend</button></td>
					 	</tr>
				{% endif %}
			{% endfor %}
		</tbody>
    </table>

{% endblock %}

{% block js_code %}
	<script>
	$('.add-bookmark').click(function(){
		var $row = $(this).closest("tr");
		// alert($row.data('id'));
		var fsqId = $row.data('id');
		var name = $row.data('name');
		var lat = $row.data('lat');
		var lng = $row.data('lng');
		var cuisine = $row.data('cuisine');
		var address = $row.data('address');
		var state = $row.data('state');
		var city = $row.data('city');
		var phone = $row.data('phone');
		var url = $row.data('url');

		var fsqData = {
				"name": name, 
				"fsqId":fsqId, 
				"lat": lat, 
				"lng": lng, 
				"cuisine": cuisine,
				"address": address,
				"city": city,
				"state": state, 
				"phone": phone,
				"url": url
			}
		//show a message telling user they have bookmarked the restaurant - callback function for get request
		function showMessage(response) {
			$(".flash-notice").html(response.message).show().fadeToggle(2000);
		}

		//get request to URL on server that saves the bkm and restaurant to db as necessary
		$.get("/save-db", fsqData, showMessage);
	});
	
	</script>
{% endblock %}