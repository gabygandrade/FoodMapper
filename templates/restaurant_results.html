{% extends 'base.html' %}

{% block head %}

{% endblock %}

{% block content %}
	<h2>Restaurant search results: </h2>
	<div class="alert alert-success" role="alert" hidden="true"></div>
	<table class="table table-striped table-hover">
	    <thead>
	        <th>Restaurant</th>
	        <th>Address</th>
	        <th>City </th>
	        <th>State</th>
	        <th>Bookmark</th>
	        <th>Recommend</th>
	    </thead>
	    <tbody>
		    {% for item in fsq_venues %}
		    	{% if item.location.address is defined %}
				    <tr class='selected-row' data-id= "{{item.id}}" data-name="{{item.name}}" data-lat="{{item.location.lat}}" data-lng="{{item.location.lng}}" data-cuisine="{{item.categories.0.shortName}}" data-address="{{item.location.address}}" data-city="{{item.location.city}}" data-state ="{{item.location.state}}" 
				    data-phone="{{item.contact.phone if item.contact.phone is defined else ''}}" data-url="{{item.url if item.url is defined else ''}}">
				        <td>{{ item['name'] }}</td>
				        <td>{{ item['location']['address'] }}</td>
				        <td>{{ item['location']['city'] }}</td>
				        <td>{{ item['location']['state'] }}</td>
				        <td><button type="button" class="btn add-bookmark">
				        	<span class="glyphicon glyphicon-bookmark "></button></td>
				        <td><button type="button" class="btn recommend" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-user"></button></td>
				 	</tr>
				{% endif %}
			{% endfor %}
		</tbody>
    </table>

    <!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Select User to Recommend this Restaurant To</h4>
	      </div>
	      <div class="modal-body">
	        USER LIST HERE 
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-primary">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>

{% endblock %}

{% block js_code %}
	<script>
	$('.add-bookmark').click(function(){
		var $row = $(this).closest("tr");
		// alert($row.data('id'));
		var fsqId = $row.data('id');
		var name = $row.data('name');
		var lat = $row.data('lat');
		var lng = $row.data('lng');
		var cuisine = $row.data('cuisine');
		var address = $row.data('address');
		var state = $row.data('state');
		var city = $row.data('city');
		var phone = $row.data('phone');
		var url = $row.data('url');

		var fsqData = {
				"name": name, 
				"fsqId":fsqId, 
				"lat": lat, 
				"lng": lng, 
				"cuisine": cuisine,
				"address": address,
				"city": city,
				"state": state, 
				"phone": phone,
				"url": url
			}
		//show a message telling user they have bookmarked the restaurant - callback function for get request
		function showMessage(response) {
			$(".alert").html(response.message).show().fadeToggle(3200);
		}

		//get request to URL on server that saves the bkm and restaurant to db as necessary
		$.get("/save-db", fsqData, showMessage);
	});

	$('.recommend').click(function(){
		// var $row = $(this).closest("tr");
		// alert($row.data('id'));
		// $("#myModal").modal("show");



		// var fsqId = $row.data('id');
		// var name = $row.data('name');
		// var lat = $row.data('lat');





		// var lng = $row.data('lng');
		// var cuisine = $row.data('cuisine');
		// var address = $row.data('address');
		// var state = $row.data('state');
		// var city = $row.data('city');
		// var phone = $row.data('phone');
		// var url = $row.data('url');

		// var fsqData = {
		// 		"name": name, 
		// 		"fsqId":fsqId, 
		// 		"lat": lat, 
		// 		"lng": lng, 
		// 		"cuisine": cuisine,
		// 		"address": address,
		// 		"city": city,
		// 		"state": state, 
		// 		"phone": phone,
		// 		"url": url
		// 	}
		// //show a message telling user they have bookmarked the restaurant - callback function for get request
		// function showMessage(response) {
		// 	$(".flash-notice").html(response.message).show().fadeToggle(3000);
		// }

		// //get request to URL on server that saves the bkm and restaurant to db as necessary
		// $.get("/save-db", fsqData, showMessage);
	});

	</script>
{% endblock %}