{% extends 'base.html' %}

{% block head %}
	<style>
		html { height:100% }
		body { height: 100%; margin:0; padding:0 }
		.container { height:100% }
		#map-canvas {
	        height: 500px;
	        margin: 0px;
	        padding: 0px
      	}
    </style>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
{% endblock %}

{% block content %}
	<div id="map-canvas"></div>
{% endblock %}

{% block js_code %}
<script>
		var map;
		//initialize the map
		function initialize() {
			var hbLocation = new google.maps.LatLng(37.788708799999995,-122.41170040000003)
			var contentString = '<div id="content">'+ '<h2>Hackbright</h2>'+'</div>';

			//var mapOptions defines the properties for the map
			var mapOptions = {
				zoom: 13,
			};

			//create a map object w/parameters from mapOptions
			map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

 			//----------------------

 			// Try HTML5 geolocation
			if(navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					var pos = new google.maps.LatLng(position.coords.latitude,
					position.coords.longitude);

				var infowindow = new google.maps.InfoWindow({
					map: map,
					position: pos,
					content: 'Location found using HTML5.'
				});

				map.setCenter(pos);
				}, function() {
					handleNoGeolocation(true);
				});
			} else {
				// Browser doesn't support Geolocation
				handleNoGeolocation(false);
				}
			}

			function handleNoGeolocation(errorFlag) {
				if (errorFlag) {
					var content = 'Error: The Geolocation service failed.';
				} else {
					var content = 'Error: Your browser doesn\'t support geolocation.';
				}

				var options = {
					map: map,
					position: new google.maps.LatLng(60, 105),
					content: content
				};

				var infowindow = new google.maps.InfoWindow(options);
				map.setCenter(options.position);
			}
 			//----------------------
			$.getJSON("/map-bookmarks", function(response){
				var json = response;
				//loop through each of the json elements, get their lat + lng & create a marker for these
				$.each(json, function(key, data){
					var lat = data.lat
					var lng = data.lng 
					var myLatLng = new google.maps.LatLng(lat, lng);

					var name = data.name
					var cuisine = data.cuisine
					var restcontent = '<div id="content">'
					+'<h3>' + name + '</h3>'
					+ '<p>'+ cuisine +'</p>'
					+'</div>'
					
					var marker = new google.maps.Marker({
						position: myLatLng,
						map: map
					}); //end of getJSON 
					marker.setMap(map);

					var infowindow = new google.maps.InfoWindow({
      					content: restcontent
 			 		});
 			 		
 			 		//add event listener to marker 
 					google.maps.event.addListener(marker, 'click', function() {
    					infowindow.open(map,marker);
  					});

				}); //end of $.each method
			});
	

		//event listener to load the map when page is loaded
		google.maps.event.addDomListener(window, 'load', initialize);

    </script>

{% endblock %}
